<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StablePay Integration Example - Merchant Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- This simulates a merchant's e-commerce site -->
    <header class="bg-white shadow-sm">
        <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-gray-800">Demo Store</h1>
            <nav class="space-x-4">
                <a href="#" class="text-gray-600 hover:text-gray-800">Products</a>
                <a href="#" class="text-gray-600 hover:text-gray-800">Cart</a>
            </nav>
        </div>
    </header>

    <main class="max-w-6xl mx-auto px-4 py-12">
        <!-- Integration Examples Section -->
        <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
            <h2 class="text-3xl font-bold text-gray-800 mb-2">StablePay Integration Examples</h2>
            <p class="text-gray-600 mb-8">See how easy it is to add USDC payments to your website</p>

            <!-- Example 1: Payment Button -->
            <div class="border-b pb-8 mb-8">
                <h3 class="text-xl font-semibold mb-4">1. Payment Button (Easiest)</h3>
                <p class="text-gray-600 mb-4">Just add a container div and let the SDK create a styled button:</p>

                <div class="bg-gray-50 rounded-lg p-6 mb-4">
                    <div id="payment-button-container" class="flex justify-center"></div>
                </div>

                <details class="bg-gray-900 rounded-lg">
                    <summary class="text-white p-4 cursor-pointer hover:bg-gray-800 rounded-lg">View Code</summary>
                    <pre class="text-green-400 p-4 overflow-x-auto text-sm"><code>&lt;!-- Add StablePay SDK --&gt;
&lt;script src="https://stablepay-nine.vercel.app/sdk/stablepay.js"&gt;&lt;/script&gt;

&lt;!-- Add a container for the button --&gt;
&lt;div id="payment-button-container"&gt;&lt;/div&gt;

&lt;script&gt;
const stablepay = new StablePay({
    merchantId: 'YOUR_MERCHANT_ID',
    environment: 'testnet',
    onPaymentSuccess: (order) =&gt; {
        alert('Payment successful! Order: ' + order.id);
        // Redirect to thank you page
        window.location.href = '/thank-you?order=' + order.id;
    }
});

stablepay.createPaymentButton('payment-button-container', {
    amount: 29.99,
    chain: 'BASE_SEPOLIA',
    productName: 'Premium Subscription'
});
&lt;/script&gt;</code></pre>
                </details>
            </div>

            <!-- Example 2: Custom Button with Popup -->
            <div class="border-b pb-8 mb-8">
                <h3 class="text-xl font-semibold mb-4">2. Custom Button with Popup Checkout</h3>
                <p class="text-gray-600 mb-4">Use your own button styling and open checkout in a popup:</p>

                <div class="bg-gray-50 rounded-lg p-6 mb-4">
                    <button id="custom-pay-btn" class="gradient-bg text-white px-8 py-3 rounded-lg font-semibold hover:opacity-90 transition">
                        Pay $49.99 with USDC
                    </button>
                </div>

                <details class="bg-gray-900 rounded-lg">
                    <summary class="text-white p-4 cursor-pointer hover:bg-gray-800 rounded-lg">View Code</summary>
                    <pre class="text-green-400 p-4 overflow-x-auto text-sm"><code>&lt;button id="custom-pay-btn" class="your-button-class"&gt;
    Pay $49.99 with USDC
&lt;/button&gt;

&lt;script&gt;
document.getElementById('custom-pay-btn').onclick = async () =&gt; {
    try {
        const result = await stablepay.openCheckout({
            amount: 49.99,
            chain: 'BASE_SEPOLIA',
            productName: 'Pro Plan',
            customerEmail: document.getElementById('email').value
        });

        // Payment successful
        console.log('Paid!', result);
        window.location.href = '/success?order=' + result.id;

    } catch (error) {
        console.error('Payment failed:', error);
    }
};
&lt;/script&gt;</code></pre>
                </details>
            </div>

            <!-- Example 3: Embedded Checkout -->
            <div class="border-b pb-8 mb-8">
                <h3 class="text-xl font-semibold mb-4">3. Embedded Checkout</h3>
                <p class="text-gray-600 mb-4">Embed the full checkout experience directly in your page:</p>

                <div class="bg-gray-50 rounded-lg p-6 mb-4">
                    <button id="embed-btn" class="bg-blue-600 text-white px-6 py-2 rounded-lg mb-4 hover:bg-blue-700">
                        Load Embedded Checkout
                    </button>
                    <div id="embedded-checkout" class="max-w-md mx-auto"></div>
                </div>

                <details class="bg-gray-900 rounded-lg">
                    <summary class="text-white p-4 cursor-pointer hover:bg-gray-800 rounded-lg">View Code</summary>
                    <pre class="text-green-400 p-4 overflow-x-auto text-sm"><code>&lt;div id="embedded-checkout" style="max-width: 450px;"&gt;&lt;/div&gt;

&lt;script&gt;
stablepay.embedCheckout('embedded-checkout', {
    amount: 99.00,
    chain: 'BASE_SEPOLIA',
    productName: 'Annual Subscription'
});
&lt;/script&gt;</code></pre>
                </details>
            </div>

            <!-- Example 4: Direct API -->
            <div class="border-b pb-8 mb-8">
                <h3 class="text-xl font-semibold mb-4">4. Direct API (Server-Side)</h3>
                <p class="text-gray-600 mb-4">Create orders from your backend and redirect to payment page:</p>

                <details class="bg-gray-900 rounded-lg">
                    <summary class="text-white p-4 cursor-pointer hover:bg-gray-800 rounded-lg">View Code</summary>
                    <pre class="text-green-400 p-4 overflow-x-auto text-sm"><code>// Node.js / Express example
app.post('/create-payment', async (req, res) =&gt; {
    const { amount, productName, customerEmail } = req.body;

    const response = await fetch('https://stablepay-nine.vercel.app/api/v1/orders', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            merchantId: process.env.STABLEPAY_MERCHANT_ID,
            amount: amount.toString(),
            chain: 'BASE_SEPOLIA',
            productName,
            customerEmail,
            paymentAddress: process.env.PAYMENT_WALLET_ADDRESS
        })
    });

    const order = await response.json();

    // Redirect to StablePay checkout
    res.redirect(`https://stablepay-nine.vercel.app/public/crypto-pay.html?orderId=${order.order.id}`);
});

// Or return the checkout URL to your frontend
app.post('/create-payment-api', async (req, res) =&gt; {
    // ... same as above ...
    res.json({
        checkoutUrl: `https://stablepay-nine.vercel.app/public/crypto-pay.html?orderId=${order.order.id}`,
        orderId: order.order.id
    });
});</code></pre>
                </details>
            </div>

            <!-- Example 5: Webhook Handler -->
            <div class="pb-8">
                <h3 class="text-xl font-semibold mb-4">5. Webhook Handler (Recommended for Production)</h3>
                <p class="text-gray-600 mb-4">Receive payment confirmations on your server:</p>

                <details class="bg-gray-900 rounded-lg">
                    <summary class="text-white p-4 cursor-pointer hover:bg-gray-800 rounded-lg">View Code</summary>
                    <pre class="text-green-400 p-4 overflow-x-auto text-sm"><code>// Express.js webhook endpoint
app.post('/webhooks/stablepay', express.json(), async (req, res) =&gt; {
    const event = req.body;

    // Verify webhook signature (recommended for production)
    // const signature = req.headers['x-stablepay-signature'];

    switch (event.type) {
        case 'payment.confirmed':
            const order = event.data;
            console.log(`Payment confirmed: ${order.id}`);

            // Update your database
            await db.orders.update({
                where: { stablePayOrderId: order.id },
                data: {
                    status: 'paid',
                    txHash: order.txHash,
                    paidAt: new Date()
                }
            });

            // Send confirmation email
            await sendEmail(order.customerEmail, 'Payment Confirmed', ...);

            // Fulfill order (grant access, ship product, etc.)
            await fulfillOrder(order);
            break;

        case 'payment.expired':
            console.log(`Payment expired: ${event.data.id}`);
            // Handle expired payment
            break;

        case 'refund.processed':
            console.log(`Refund processed: ${event.data.id}`);
            // Handle refund
            break;
    }

    res.json({ received: true });
});</code></pre>
                </details>
            </div>
        </div>

        <!-- Product Card Example -->
        <div class="bg-white rounded-xl shadow-lg p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">Product Card Example</h2>
            <p class="text-gray-600 mb-6">Here's how a real product card might look with StablePay integration:</p>

            <div class="grid md:grid-cols-3 gap-6">
                <!-- Product 1 -->
                <div class="border rounded-xl p-6 hover:shadow-lg transition">
                    <div class="bg-gradient-to-br from-blue-100 to-purple-100 h-40 rounded-lg mb-4 flex items-center justify-center">
                        <span class="text-6xl">üé®</span>
                    </div>
                    <h3 class="font-semibold text-lg mb-2">Basic Plan</h3>
                    <p class="text-gray-600 text-sm mb-4">Perfect for getting started</p>
                    <p class="text-2xl font-bold mb-4">$9.99 <span class="text-sm text-gray-500">USDC</span></p>
                    <div id="product-1-btn"></div>
                </div>

                <!-- Product 2 -->
                <div class="border-2 border-blue-500 rounded-xl p-6 hover:shadow-lg transition relative">
                    <span class="absolute -top-3 left-1/2 -translate-x-1/2 bg-blue-500 text-white text-xs px-3 py-1 rounded-full">Popular</span>
                    <div class="bg-gradient-to-br from-blue-100 to-purple-100 h-40 rounded-lg mb-4 flex items-center justify-center">
                        <span class="text-6xl">üöÄ</span>
                    </div>
                    <h3 class="font-semibold text-lg mb-2">Pro Plan</h3>
                    <p class="text-gray-600 text-sm mb-4">For growing businesses</p>
                    <p class="text-2xl font-bold mb-4">$29.99 <span class="text-sm text-gray-500">USDC</span></p>
                    <div id="product-2-btn"></div>
                </div>

                <!-- Product 3 -->
                <div class="border rounded-xl p-6 hover:shadow-lg transition">
                    <div class="bg-gradient-to-br from-blue-100 to-purple-100 h-40 rounded-lg mb-4 flex items-center justify-center">
                        <span class="text-6xl">üè¢</span>
                    </div>
                    <h3 class="font-semibold text-lg mb-2">Enterprise</h3>
                    <p class="text-gray-600 text-sm mb-4">For large organizations</p>
                    <p class="text-2xl font-bold mb-4">$99.99 <span class="text-sm text-gray-500">USDC</span></p>
                    <div id="product-3-btn"></div>
                </div>
            </div>
        </div>

        <!-- Get Started CTA -->
        <div class="mt-8 bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl p-8 text-center text-white">
            <h2 class="text-2xl font-bold mb-4">Ready to Accept USDC Payments?</h2>
            <p class="mb-6 opacity-90">Sign up for a merchant account and start accepting crypto payments today</p>
            <div class="flex justify-center gap-4">
                <a href="/public/signup.html" class="bg-white text-blue-600 px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 transition">Sign Up Free</a>
                <a href="/public/developers.html" class="border border-white px-6 py-3 rounded-lg font-semibold hover:bg-white/10 transition">View Full Docs</a>
            </div>
        </div>
    </main>

    <!-- StablePay SDK -->
    <script src="/sdk/stablepay.js"></script>
    <script>
        // Initialize StablePay
        const stablepay = new StablePay({
            merchantId: 'demo-merchant-integration',
            environment: 'testnet',
            onPaymentSuccess: (order) => {
                alert('Payment successful!\n\nOrder ID: ' + order.id + '\nAmount: $' + order.amount + ' USDC\n\nIn a real app, you would redirect to a success page.');
            },
            onPaymentError: (error) => {
                alert('Payment failed: ' + error.message);
            }
        });

        // Create payment buttons for the examples section
        stablepay.createPaymentButton('payment-button-container', {
            amount: 29.99,
            chain: 'BASE_SEPOLIA',
            productName: 'Premium Subscription',
            buttonText: 'Subscribe - $29.99/mo'
        });

        // Custom button popup checkout
        document.getElementById('custom-pay-btn').onclick = async () => {
            const btn = document.getElementById('custom-pay-btn');
            btn.textContent = 'Processing...';
            btn.disabled = true;

            try {
                const result = await stablepay.openCheckout({
                    amount: 49.99,
                    chain: 'BASE_SEPOLIA',
                    productName: 'Pro Plan'
                });
                console.log('Payment result:', result);
            } catch (error) {
                console.error('Payment error:', error);
            } finally {
                btn.textContent = 'Pay $49.99 with USDC';
                btn.disabled = false;
            }
        };

        // Embedded checkout button
        document.getElementById('embed-btn').onclick = async () => {
            const btn = document.getElementById('embed-btn');
            btn.textContent = 'Loading...';
            btn.disabled = true;

            try {
                await stablepay.embedCheckout('embedded-checkout', {
                    amount: 99.00,
                    chain: 'BASE_SEPOLIA',
                    productName: 'Annual Subscription'
                });
                btn.style.display = 'none';
            } catch (error) {
                alert('Error: ' + error.message);
                btn.textContent = 'Load Embedded Checkout';
                btn.disabled = false;
            }
        };

        // Product card buttons
        stablepay.createPaymentButton('product-1-btn', {
            amount: 9.99,
            chain: 'BASE_SEPOLIA',
            productName: 'Basic Plan',
            buttonText: 'Buy Now'
        });

        stablepay.createPaymentButton('product-2-btn', {
            amount: 29.99,
            chain: 'BASE_SEPOLIA',
            productName: 'Pro Plan',
            buttonText: 'Buy Now'
        });

        stablepay.createPaymentButton('product-3-btn', {
            amount: 99.99,
            chain: 'BASE_SEPOLIA',
            productName: 'Enterprise Plan',
            buttonText: 'Buy Now'
        });
    </script>
</body>
</html>
