<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merchant Onboarding - StablePay</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="max-w-4xl mx-auto px-4 py-12">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-2">
                Welcome to StablePay
            </h1>
            <p class="text-gray-600">Complete your merchant account setup in 3 easy steps</p>
        </div>

        <!-- Progress Bar -->
        <div class="mb-8">
            <div class="flex justify-between items-center">
                <div class="flex-1">
                    <div class="flex items-center">
                        <div id="step1Indicator" class="w-10 h-10 rounded-full bg-blue-600 text-white flex items-center justify-center font-bold">1</div>
                        <div class="flex-1 h-1 bg-blue-600 mx-2"></div>
                    </div>
                    <p class="text-sm mt-2 text-blue-600 font-medium">Company Info</p>
                </div>
                <div class="flex-1">
                    <div class="flex items-center">
                        <div id="step2Indicator" class="w-10 h-10 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center font-bold">2</div>
                        <div class="flex-1 h-1 bg-gray-300 mx-2"></div>
                    </div>
                    <p class="text-sm mt-2 text-gray-500">Wallet Setup</p>
                </div>
                <div class="flex-1">
                    <div class="flex items-center">
                        <div id="step3Indicator" class="w-10 h-10 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center font-bold">3</div>
                    </div>
                    <p class="text-sm mt-2 text-gray-500">Review</p>
                </div>
            </div>
        </div>

        <!-- Step 1: Company Information -->
        <div id="step1" class="bg-white rounded-xl shadow-lg p-8 mb-6">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Company Information</h2>
            <form id="step1Form" class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Company Name *</label>
                        <input
                            type="text"
                            id="companyName"
                            required
                            placeholder="Acme Corp"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"
                        >
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Contact Name *</label>
                        <input
                            type="text"
                            id="contactName"
                            required
                            placeholder="John Doe"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"
                        >
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                        <input
                            type="email"
                            id="email"
                            required
                            placeholder="contact@acmecorp.com"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"
                        >
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Website</label>
                        <input
                            type="url"
                            id="website"
                            placeholder="https://acmecorp.com"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"
                        >
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Industry</label>
                    <select id="industry" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500">
                        <option value="">Select industry...</option>
                        <option value="E-commerce">E-commerce</option>
                        <option value="SaaS">SaaS</option>
                        <option value="Gaming">Gaming</option>
                        <option value="NFT/Digital Art">NFT/Digital Art</option>
                        <option value="DeFi">DeFi</option>
                        <option value="Marketplace">Marketplace</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Expected Monthly Volume (USDC)</label>
                    <select id="monthlyVolume" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500">
                        <option value="">Select range...</option>
                        <option value="1000">$0 - $1,000</option>
                        <option value="10000">$1,000 - $10,000</option>
                        <option value="50000">$10,000 - $50,000</option>
                        <option value="100000">$50,000 - $100,000</option>
                        <option value="500000">$100,000+</option>
                    </select>
                </div>

                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg font-medium">
                    Next: Wallet Setup ‚Üí
                </button>
            </form>
        </div>

        <!-- Step 2: Wallet Setup -->
        <div id="step2" class="hidden bg-white rounded-xl shadow-lg p-8 mb-6">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Payment Wallet Setup</h2>
            <p class="text-gray-600 mb-6">
                Enter your wallet addresses where you'll receive USDC payments. You can add wallets for multiple chains.
            </p>

            <form id="step2Form" class="space-y-6">
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                    <p class="text-sm text-blue-800">
                        üí° <strong>Tip:</strong> Start with testnet addresses to test the integration before going live.
                    </p>
                </div>

                <div>
                    <div class="flex items-center justify-between mb-2">
                        <label class="block text-sm font-medium text-gray-700">Base Sepolia (Testnet)</label>
                        <span class="text-xs text-gray-500">Optional</span>
                    </div>
                    <input
                        type="text"
                        id="walletBaseSepolia"
                        placeholder="0x..."
                        pattern="^0x[a-fA-F0-9]{40}$"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 font-mono text-sm"
                    >
                </div>

                <div>
                    <div class="flex items-center justify-between mb-2">
                        <label class="block text-sm font-medium text-gray-700">Ethereum Sepolia (Testnet)</label>
                        <span class="text-xs text-gray-500">Optional</span>
                    </div>
                    <input
                        type="text"
                        id="walletEthereumSepolia"
                        placeholder="0x..."
                        pattern="^0x[a-fA-F0-9]{40}$"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 font-mono text-sm"
                    >
                </div>

                <div class="border-t pt-6">
                    <h3 class="font-semibold text-gray-900 mb-4">Mainnet Wallets (Production)</h3>

                    <div class="mb-4">
                        <div class="flex items-center justify-between mb-2">
                            <label class="block text-sm font-medium text-gray-700">Base Mainnet</label>
                            <span class="text-xs text-gray-500">Optional</span>
                        </div>
                        <input
                            type="text"
                            id="walletBaseMainnet"
                            placeholder="0x..."
                            pattern="^0x[a-fA-F0-9]{40}$"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 font-mono text-sm"
                        >
                    </div>

                    <div>
                        <div class="flex items-center justify-between mb-2">
                            <label class="block text-sm font-medium text-gray-700">Ethereum Mainnet</label>
                            <span class="text-xs text-gray-500">Optional</span>
                        </div>
                        <input
                            type="text"
                            id="walletEthereumMainnet"
                            placeholder="0x..."
                            pattern="^0x[a-fA-F0-9]{40}$"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 font-mono text-sm"
                        >
                    </div>
                </div>

                <div class="flex space-x-4">
                    <button type="button" id="backToStep1" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 py-3 px-4 rounded-lg font-medium">
                        ‚Üê Back
                    </button>
                    <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg font-medium">
                        Next: Review ‚Üí
                    </button>
                </div>
            </form>
        </div>

        <!-- Step 3: Review & Submit -->
        <div id="step3" class="hidden bg-white rounded-xl shadow-lg p-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Review Your Information</h2>

            <div id="reviewContent" class="space-y-6 mb-6">
                <!-- Populated dynamically -->
            </div>

            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
                <p class="text-sm text-yellow-800">
                    ‚ö†Ô∏è <strong>Important:</strong> After submission, you'll receive an email with your temporary password and API keys.
                </p>
            </div>

            <div class="flex space-x-4">
                <button type="button" id="backToStep2" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 py-3 px-4 rounded-lg font-medium">
                    ‚Üê Back
                </button>
                <button type="button" id="submitOnboarding" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-3 px-4 rounded-lg font-medium">
                    ‚úì Complete Setup
                </button>
            </div>
        </div>

        <!-- Success Message -->
        <div id="successMessage" class="hidden bg-white rounded-xl shadow-lg p-8 text-center">
            <div class="mb-6">
                <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="text-4xl">‚úì</span>
                </div>
                <h2 class="text-3xl font-bold text-gray-900 mb-2">Welcome Aboard!</h2>
                <p class="text-gray-600">Your merchant account has been created successfully.</p>
            </div>

            <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6 text-left">
                <h3 class="font-semibold text-gray-900 mb-3">Next Steps:</h3>
                <ol class="space-y-2 text-sm text-gray-700">
                    <li>1. Check your email for login credentials</li>
                    <li>2. Log in to your merchant dashboard</li>
                    <li>3. Generate your API keys in the Developer Console</li>
                    <li>4. Start accepting USDC payments!</li>
                </ol>
            </div>

            <div class="space-y-3">
                <a href="/login.html" class="block w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg font-medium">
                    Go to Login ‚Üí
                </a>
                <a href="/developers.html" class="block w-full bg-gray-200 hover:bg-gray-300 text-gray-700 py-3 px-4 rounded-lg font-medium">
                    View Documentation
                </a>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin;
        let currentStep = 1;
        let formData = {};

        // Step 1 Form
        document.getElementById('step1Form').addEventListener('submit', (e) => {
            e.preventDefault();
            formData.companyName = document.getElementById('companyName').value;
            formData.contactName = document.getElementById('contactName').value;
            formData.email = document.getElementById('email').value;
            formData.website = document.getElementById('website').value;
            formData.industry = document.getElementById('industry').value;
            formData.monthlyVolume = document.getElementById('monthlyVolume').value;

            goToStep(2);
        });

        // Step 2 Form
        document.getElementById('step2Form').addEventListener('submit', (e) => {
            e.preventDefault();

            formData.wallets = {
                BASE_SEPOLIA: document.getElementById('walletBaseSepolia').value,
                ETHEREUM_SEPOLIA: document.getElementById('walletEthereumSepolia').value,
                BASE_MAINNET: document.getElementById('walletBaseMainnet').value,
                ETHEREUM_MAINNET: document.getElementById('walletEthereumMainnet').value
            };

            // Filter out empty wallets
            Object.keys(formData.wallets).forEach(key => {
                if (!formData.wallets[key]) {
                    delete formData.wallets[key];
                }
            });

            showReview();
            goToStep(3);
        });

        // Back buttons
        document.getElementById('backToStep1').addEventListener('click', () => goToStep(1));
        document.getElementById('backToStep2').addEventListener('click', () => goToStep(2));

        // Submit onboarding
        document.getElementById('submitOnboarding').addEventListener('click', async () => {
            const submitBtn = document.getElementById('submitOnboarding');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Creating account...';

            try {
                const response = await fetch(`${API_BASE}/api/v1/admin/merchants`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer admin-token'
                    },
                    body: JSON.stringify({
                        email: formData.email,
                        companyName: formData.companyName,
                        contactName: formData.contactName,
                        website: formData.website,
                        industry: formData.industry,
                        monthlyVolume: formData.monthlyVolume,
                        plan: determineplan(formData.monthlyVolume),
                        networkMode: 'TESTNET',
                        isActive: true
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    console.log('Merchant created:', result);

                    // TODO: Create wallet associations
                    // For now, just show success

                    showSuccess();
                } else {
                    const error = await response.json();
                    alert('Error: ' + (error.error || 'Failed to create merchant'));
                    submitBtn.disabled = false;
                    submitBtn.textContent = '‚úì Complete Setup';
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error creating merchant account. Please try again.');
                submitBtn.disabled = false;
                submitBtn.textContent = '‚úì Complete Setup';
            }
        });

        // Helper functions
        function goToStep(step) {
            // Hide all steps
            document.getElementById('step1').classList.add('hidden');
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('step3').classList.add('hidden');

            // Show current step
            document.getElementById('step' + step).classList.remove('hidden');

            // Update indicators
            for (let i = 1; i <= 3; i++) {
                const indicator = document.getElementById('step' + i + 'Indicator');
                if (i < step) {
                    indicator.className = 'w-10 h-10 rounded-full bg-green-600 text-white flex items-center justify-center font-bold';
                    indicator.textContent = '‚úì';
                } else if (i === step) {
                    indicator.className = 'w-10 h-10 rounded-full bg-blue-600 text-white flex items-center justify-center font-bold';
                    indicator.textContent = i;
                } else {
                    indicator.className = 'w-10 h-10 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center font-bold';
                    indicator.textContent = i;
                }
            }

            currentStep = step;
        }

        function showReview() {
            const content = `
                <div>
                    <h3 class="font-semibold text-gray-900 mb-3">Company Information</h3>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div><span class="text-gray-500">Company:</span> ${formData.companyName}</div>
                        <div><span class="text-gray-500">Contact:</span> ${formData.contactName}</div>
                        <div><span class="text-gray-500">Email:</span> ${formData.email}</div>
                        <div><span class="text-gray-500">Website:</span> ${formData.website || 'Not provided'}</div>
                        <div><span class="text-gray-500">Industry:</span> ${formData.industry || 'Not specified'}</div>
                        <div><span class="text-gray-500">Monthly Volume:</span> $${formData.monthlyVolume || 'Not specified'}</div>
                    </div>
                </div>

                <div class="border-t pt-6">
                    <h3 class="font-semibold text-gray-900 mb-3">Payment Wallets</h3>
                    <div class="space-y-2 text-sm">
                        ${Object.entries(formData.wallets).map(([chain, address]) => `
                            <div class="flex justify-between">
                                <span class="text-gray-500">${chain.replace('_', ' ')}:</span>
                                <span class="font-mono text-xs">${address}</span>
                            </div>
                        `).join('')}
                        ${Object.keys(formData.wallets).length === 0 ? '<p class="text-gray-500">No wallets configured yet</p>' : ''}
                    </div>
                </div>
            `;

            document.getElementById('reviewContent').innerHTML = content;
        }

        function showSuccess() {
            document.getElementById('step3').classList.add('hidden');
            document.getElementById('successMessage').classList.remove('hidden');
        }

        function determineplan(volume) {
            const vol = parseInt(volume) || 0;
            if (vol >= 100000) return 'ENTERPRISE';
            if (vol >= 10000) return 'GROWTH';
            return 'STARTER';
        }

        // Initialize
        goToStep(1);
    </script>
</body>
</html>
