<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merchant Dashboard - StablePay</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="js/chain-config.js"></script>
    <style>
        body {
            background: #0a0a0f;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        .network-badge {
            background: linear-gradient(90deg, #f59e0b, #ef4444);
            animation: gradient 3s ease infinite;
            background-size: 400% 400%;
        }
        .mainnet-badge {
            background: linear-gradient(90deg, #059669, #0891b2);
            animation: gradient 3s ease infinite;
            background-size: 400% 400%;
        }
        @keyframes gradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        .status-pending { @apply bg-yellow-900/20 text-yellow-400 border border-yellow-800; }
        .status-paid { @apply bg-blue-900/20 text-blue-400 border border-blue-800; }
        .status-confirmed { @apply bg-green-900/20 text-green-400 border border-green-800; }
        .status-failed { @apply bg-red-900/20 text-red-400 border border-red-800; }
        .status-expired { @apply bg-slate-900/20 text-slate-400 border border-slate-800; }
    </style>
</head>
<body class="bg-slate-950">
    <!-- Network Banner -->
    <div id="networkBanner" class="network-badge text-white text-center py-2 text-sm font-bold">
        üß™ MERCHANT DASHBOARD - Testnet Mode
    </div>

    <!-- Navigation -->

    <!-- Pending Account Banner -->
    <div id="pendingBanner" class="hidden bg-yellow-50 border-b-2 border-yellow-400">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <span class="text-2xl mr-3">‚è≥</span>
                    <div>
                        <p class="font-semibold text-yellow-800">Account Pending Approval</p>
                        <p class="text-sm text-yellow-700">Your account is being reviewed. Full features will be enabled once activated by our team.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <nav class="bg-slate-950 shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <a href="/" class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                        StablePay
                    </a>
                    <span class="ml-4 px-3 py-1 bg-blue-900/20 text-blue-800 rounded-full text-sm font-medium">
                        Merchant Dashboard
                    </span>
                </div>
                <div class="flex items-center space-x-4">
                    <!-- Network Mode Toggle -->
                    <div class="flex items-center bg-slate-900/20 border border p-1">
                        <button 
                            id="testnetBtn"
                            class="network-btn px-3 py-1 rounded text-sm font-medium transition-colors bg-orange-100 text-orange-800"
                        >
                            üß™ Testnet
                        </button>
                        <button 
                            id="mainnetBtn"
                            class="network-btn px-3 py-1 rounded text-sm font-medium transition-colors text-slate-400 hover:bg-slate-900/20"
                        >
                            üåê Mainnet
                        </button>
                    </div>
                    <div class="text-sm text-slate-400" id="merchantInfo">
                        <span class="font-medium text-white" id="merchantName">Loading...</span>
                    </div>
                    <button 
                        id="logoutBtn"
                        class="text-slate-400 hover:text-white px-3 py-2  text-sm font-medium"
                    >
                        üö™ Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Merchant Profile Card -->
        <div class="bg-slate-950 border shadow-sm border mb-8 overflow-hidden">
            <div class="bg-gradient-to-r from-blue-600 to-purple-600 p-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="w-16 h-16 bg-slate-950 rounded-full flex items-center justify-center text-3xl">
                            üè¢
                        </div>
                        <div class="text-white">
                            <h1 class="text-2xl font-bold" id="profileCompanyName">Loading...</h1>
                            <p class="text-blue-100" id="profileEmail">...</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="inline-flex items-center px-4 py-2 rounded-full text-sm font-medium mb-2" id="profileStatusBadge">
                            <span class="mr-2">‚è≥</span>
                            <span>Pending Approval</span>
                        </div>
                        <div class="text-white text-sm">
                            <span class="opacity-75">Plan:</span>
                            <span class="font-semibold ml-1" id="profilePlan">Starter</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="p-6 bg-slate-950">
                <div class="grid grid-cols-4 gap-6">
                    <div>
                        <div class="text-sm text-slate-400 mb-1">Contact</div>
                        <div class="font-medium text-white" id="profileContact">-</div>
                    </div>
                    <div>
                        <div class="text-sm text-slate-400 mb-1">Network Mode</div>
                        <div class="font-medium text-white" id="profileNetworkMode">Testnet</div>
                    </div>
                    <div>
                        <div class="text-sm text-slate-400 mb-1">Total Orders</div>
                        <div class="font-medium text-white" id="profileOrderCount">0</div>
                    </div>
                    <div>
                        <div class="text-sm text-slate-400 mb-1">Member Since</div>
                        <div class="font-medium text-white" id="profileCreatedAt">-</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-slate-950 border p-6 shadow-sm border">
                <div class="flex items-center">
                    <div class="p-2 bg-blue-900/20 border">
                        <span class="text-2xl">üìã</span>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-slate-400">Total Orders</p>
                        <p class="text-2xl font-bold text-white" id="totalOrders">0</p>
                    </div>
                </div>
            </div>

            <div class="bg-slate-950 border p-6 shadow-sm border">
                <div class="flex items-center">
                    <div class="p-2 bg-green-900/20 border">
                        <span class="text-2xl">‚úÖ</span>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-slate-400">Confirmed</p>
                        <p class="text-2xl font-bold text-green-400" id="confirmedOrders">0</p>
                    </div>
                </div>
            </div>

            <div class="bg-slate-950 border p-6 shadow-sm border">
                <div class="flex items-center">
                    <div class="p-2 bg-yellow-900/20 border">
                        <span class="text-2xl">‚è≥</span>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-slate-400">Pending</p>
                        <p class="text-2xl font-bold text-yellow-600" id="pendingOrders">0</p>
                    </div>
                </div>
            </div>

            <div class="bg-slate-950 border p-6 shadow-sm border">
                <div class="flex items-center">
                    <div class="p-2 bg-purple-900/20 border">
                        <span class="text-2xl">üí∞</span>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-slate-400">Total Volume</p>
                        <p class="text-2xl font-bold text-purple-400" id="totalVolume">$0</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Tabs -->
        <div class="bg-slate-950 border shadow-sm border">
            <!-- Tab Navigation -->
            <div class="border-b border-slate-800">
                <nav class="-mb-px flex space-x-8 px-6" aria-label="Tabs">
                    <button class="tab-btn border-blue-500 text-blue-400 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-tab="orders">
                        Orders
                    </button>
                    <button class="tab-btn border-transparent text-slate-400 hover:text-slate-300 hover:border-slate-800 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-tab="wallets">
                        Wallets
                    </button>
                    <button class="tab-btn border-transparent text-slate-400 hover:text-slate-300 hover:border-slate-800 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-tab="developer">
                        Developer
                    </button>
                    <button class="tab-btn border-transparent text-slate-400 hover:text-slate-300 hover:border-slate-800 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-tab="payments">
                        Payment Links
                    </button>
                    <button class="tab-btn border-transparent text-slate-400 hover:text-slate-300 hover:border-slate-800 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-tab="settings">
                        Settings
                    </button>
                </nav>
            </div>

            <!-- Tab Content -->
            <div class="p-6">
                <!-- Orders Tab -->
                <div id="ordersTab" class="tab-content">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold text-white">Recent Orders</h3>
                        <button 
                            id="refreshOrdersBtn"
                            class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 border font-medium transition-colors text-sm"
                        >
                            üîÑ Refresh
                        </button>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-slate-950">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Order ID</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Amount</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Chain</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Customer</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Created</th>
                                </tr>
                            </thead>
                            <tbody id="ordersTableBody" class="bg-slate-950 divide-y divide-slate-800">
                                <tr>
                                    <td colspan="6" class="px-6 py-12 text-center text-slate-400">
                                        <div class="flex flex-col items-center">
                                            <div class="animate-pulse w-8 h-8 bg-gray-300 rounded mb-4"></div>
                                            <p>Loading orders...</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Wallets Tab -->
                <div id="walletsTab" class="tab-content hidden">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h3 class="text-lg font-semibold text-white">üí∞ Payment Chains & Wallets</h3>
                            <p class="text-sm text-slate-400 mt-1">Configure which blockchains to accept payments on and set your wallet addresses</p>
                        </div>
                        <button
                            id="saveWalletsBtn"
                            class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 border font-medium transition-colors"
                        >
                            üíæ Save Configuration
                        </button>
                    </div>

                    <div id="walletsContainer" class="space-y-3">
                        <!-- Populated dynamically with chain toggles -->
                    </div>

                    <!-- Quick Actions -->
                    <div class="mt-8 bg-gradient-to-r from-purple-50 to-blue-50 border p-6 border border-purple-200">
                        <h4 class="text-lg font-semibold text-white mb-4">üöÄ Quick Actions</h4>
                        <div class="grid grid-cols-2 gap-4">
                            <button
                                id="createDemoStoreBtn"
                                class="bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white px-6 py-3 border font-medium transition-all shadow-lg hover:shadow-xl"
                            >
                                üè™ Create Demo Store
                            </button>
                            <button
                                id="testPaymentBtn"
                                class="bg-slate-950 border-2 border-purple-300 hover:border-purple-500 text-purple-700 px-6 py-3 border font-medium transition-all"
                            >
                                ‚ö° Test Payment
                            </button>
                        </div>
                        <p class="text-sm text-slate-400 mt-3">
                            üí° Create a demo store with your configured wallets or test a payment flow
                        </p>
                    </div>
                </div>

                <!-- Developer Tab -->
                <div id="developerTab" class="tab-content hidden">
                    <div class="space-y-6">
                        <!-- API Keys Section -->
                        <div class="bg-slate-950 border shadow-sm border p-6">
                            <div class="flex justify-between items-center mb-6">
                                <div>
                                    <h3 class="text-lg font-semibold text-white">üîë API Keys</h3>
                                    <p class="text-sm text-slate-400 mt-1">Use these keys to integrate StablePay into your application</p>
                                </div>
                                <button id="generateApiKeyBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 border font-medium transition-colors text-sm">
                                    ‚ûï Generate New Key
                                </button>
                            </div>

                            <div class="space-y-4">
                                <div class="bg-slate-950 border p-4 border border-slate-800">
                                    <div class="flex justify-between items-start">
                                        <div class="flex-1">
                                            <div class="text-sm font-medium text-slate-300 mb-1">Merchant ID</div>
                                            <code class="text-sm bg-slate-950 px-3 py-2 rounded border border-slate-800 inline-block font-mono" id="apiMerchantId">Loading...</code>
                                        </div>
                                        <button onclick="navigator.clipboard.writeText(document.getElementById('apiMerchantId').textContent); alert('‚úÖ Copied!')" class="text-blue-400 hover:text-blue-700 text-sm font-medium ml-4">
                                            üìã Copy
                                        </button>
                                    </div>
                                </div>

                                <div class="bg-yellow-50 border p-4 border border-yellow-300">
                                    <div class="flex items-start">
                                        <span class="text-2xl mr-3">‚ö†Ô∏è</span>
                                        <div>
                                            <div class="text-sm font-medium text-yellow-800 mb-1">Keep your API keys secure</div>
                                            <p class="text-xs text-yellow-700">Never share your API keys publicly or commit them to version control</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- API Documentation -->
                        <div class="bg-slate-950 border shadow-sm border p-6">
                            <h3 class="text-lg font-semibold text-white mb-6">üìö API Endpoints</h3>

                            <!-- Create Order -->
                            <div class="mb-8">
                                <div class="flex items-center mb-3">
                                    <span class="px-3 py-1 bg-green-900/20 text-green-800 rounded-full text-xs font-bold mr-3">POST</span>
                                    <code class="text-sm font-mono text-slate-300">/api/orders-simple</code>
                                </div>
                                <p class="text-sm text-slate-400 mb-4">Create a new payment order</p>

                                <div class="bg-gray-900 border p-4 overflow-x-auto">
                                    <pre class="text-xs text-green-400 font-mono">curl -X POST https://stablepay-nine.vercel.app/api/orders-simple \\
  -H "Content-Type: application/json" \\
  -d '{
    "merchantId": "YOUR_MERCHANT_ID",
    "amount": "10.00",
    "chain": "BASE_SEPOLIA",
    "customerEmail": "customer@example.com"
  }'</pre>
                                </div>

                                <button onclick="testCreateOrder()" class="mt-3 text-blue-400 hover:text-blue-700 text-sm font-medium">
                                    ‚ö° Test this endpoint
                                </button>
                            </div>

                            <!-- Get Order -->
                            <div class="mb-8">
                                <div class="flex items-center mb-3">
                                    <span class="px-3 py-1 bg-blue-900/20 text-blue-800 rounded-full text-xs font-bold mr-3">GET</span>
                                    <code class="text-sm font-mono text-slate-300">/api/orders/:orderId</code>
                                </div>
                                <p class="text-sm text-slate-400 mb-4">Get order status and details</p>

                                <div class="bg-gray-900 border p-4 overflow-x-auto">
                                    <pre class="text-xs text-green-400 font-mono">curl https://stablepay-nine.vercel.app/api/orders/ORDER_ID</pre>
                                </div>
                            </div>

                            <!-- List Orders -->
                            <div>
                                <div class="flex items-center mb-3">
                                    <span class="px-3 py-1 bg-blue-900/20 text-blue-800 rounded-full text-xs font-bold mr-3">GET</span>
                                    <code class="text-sm font-mono text-slate-300">/api/v1/admin?resource=orders&merchantId=YOUR_ID</code>
                                </div>
                                <p class="text-sm text-slate-400 mb-4">List all orders for your merchant account</p>

                                <div class="bg-gray-900 border p-4 overflow-x-auto">
                                    <pre class="text-xs text-green-400 font-mono">curl https://stablepay-nine.vercel.app/api/v1/admin?resource=orders&merchantId=YOUR_ID \\
  -H "Authorization: Bearer YOUR_TOKEN"</pre>
                                </div>
                            </div>
                        </div>

                        <!-- Code Examples -->
                        <div class="bg-slate-950 border shadow-sm border p-6">
                            <h3 class="text-lg font-semibold text-white mb-6">üíª Code Examples</h3>

                            <div class="space-y-4">
                                <!-- JavaScript -->
                                <div>
                                    <div class="flex items-center mb-2">
                                        <span class="text-yellow-500 mr-2">üì¶</span>
                                        <span class="font-medium text-white">JavaScript / Node.js</span>
                                    </div>
                                    <div class="bg-gray-900 border p-4 overflow-x-auto">
                                        <pre class="text-xs text-green-400 font-mono">const response = await fetch('https://stablepay-nine.vercel.app/api/orders-simple', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    merchantId: 'YOUR_MERCHANT_ID',
    amount: '10.00',
    chain: 'BASE_SEPOLIA',
    customerEmail: 'customer@example.com'
  })
});

const order = await response.json();
console.log('Order created:', order.id);</pre>
                                    </div>
                                </div>

                                <!-- Python -->
                                <div>
                                    <div class="flex items-center mb-2">
                                        <span class="text-blue-500 mr-2">üêç</span>
                                        <span class="font-medium text-white">Python</span>
                                    </div>
                                    <div class="bg-gray-900 border p-4 overflow-x-auto">
                                        <pre class="text-xs text-green-400 font-mono">import requests

response = requests.post(
    'https://stablepay-nine.vercel.app/api/orders-simple',
    json={
        'merchantId': 'YOUR_MERCHANT_ID',
        'amount': '10.00',
        'chain': 'BASE_SEPOLIA',
        'customerEmail': 'customer@example.com'
    }
)

order = response.json()
print(f"Order created: {order['id']}")</pre>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Webhooks -->
                        <div class="bg-slate-950 border shadow-sm border p-6">
                            <div class="flex justify-between items-center mb-6">
                                <div>
                                    <h3 class="text-lg font-semibold text-white">üîî Webhooks</h3>
                                    <p class="text-sm text-slate-400 mt-1">Get notified when payment status changes</p>
                                </div>
                                <span class="px-3 py-1 bg-purple-900/20 text-purple-800 rounded-full text-xs font-medium">
                                    Coming Soon
                                </span>
                            </div>
                            <p class="text-sm text-slate-400">Configure webhook endpoints to receive real-time payment notifications</p>
                        </div>
                    </div>
                </div>

                <!-- Payment Links Tab -->
                <div id="paymentsTab" class="tab-content hidden">
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">üîó</div>
                        <h3 class="text-xl font-bold text-white mb-2">Payment Links</h3>
                        <p class="text-slate-400 mb-6">Create shareable payment links - Coming soon!</p>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div id="settingsTab" class="tab-content hidden">
                    <div class="space-y-8">
                        <!-- Account Information -->
                        <div>
                            <h3 class="text-lg font-semibold text-white mb-4">Account Information</h3>
                            <div class="bg-slate-950 border p-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-slate-300 mb-2">Company Name</label>
                                        <input type="text" id="companyName" class="w-full px-3 py-2 border border-slate-800 border focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-slate-300 mb-2">Contact Name</label>
                                        <input type="text" id="contactName" class="w-full px-3 py-2 border border-slate-800 border focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-slate-300 mb-2">Email</label>
                                        <input type="email" id="email" class="w-full px-3 py-2 border border-slate-800 border focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-slate-300 mb-2">Plan</label>
                                        <input type="text" id="plan" class="w-full px-3 py-2 border border-slate-800 border focus:ring-2 focus:ring-blue-500 focus:border-blue-500" readonly>
                                    </div>
                                </div>
                                <div class="mt-6">
                                    <button id="saveProfileBtn" type="button" class="bg-blue-600 text-white px-6 py-2 border hover:bg-blue-700 transition-colors">
                                        üíæ Save Profile
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Network Preferences -->
                        <div>
                            <h3 class="text-lg font-semibold text-white mb-4">Network Preferences</h3>
                            <div class="bg-slate-950 border p-6">
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-slate-300 mb-2">Default Network Mode</label>
                                        <select id="defaultNetworkMode" class="w-full px-3 py-2 border border-slate-800 border focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                            <option value="TESTNET">Testnet (for development)</option>
                                            <option value="MAINNET">Mainnet (for production)</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-slate-300 mb-2">Payment Mode</label>
                                        <select id="paymentMode" class="w-full px-3 py-2 border border-slate-800 border focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                            <option value="DIRECT">Direct (payments go directly to your wallets)</option>
                                            <option value="ESCROW">Escrow (payments held until confirmation)</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="mt-6">
                                    <button 
                                        id="saveSettingsBtn"
                                        class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 border font-medium transition-colors"
                                    >
                                        üíæ Save Settings
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Wallet Modal -->
    <div id="addWalletModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-slate-950 border max-w-md w-full">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold">Add Payment Wallet</h3>
                        <button id="closeWalletModal" class="text-slate-400 hover:text-slate-300">
                            <span class="text-2xl">&times;</span>
                        </button>
                    </div>
                    
                    <form id="addWalletForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">Blockchain</label>
                            <select id="walletChain" class="w-full px-3 py-2 border border-slate-800 border focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <!-- Options will be populated dynamically based on network mode -->
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">Wallet Address</label>
                            <input 
                                type="text" 
                                id="walletAddress" 
                                placeholder="Enter your wallet address"
                                class="w-full px-3 py-2 border border-slate-800 border focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                required
                            >
                            <p class="text-xs text-slate-400 mt-1">This is where USDC payments will be sent</p>
                        </div>
                        <div class="flex space-x-4 pt-4">
                            <button 
                                type="submit"
                                class="flex-1 bg-blue-600 text-white py-2 border hover:bg-blue-700 transition-colors"
                            >
                                Add Wallet
                            </button>
                            <button 
                                type="button"
                                id="cancelWalletModal"
                                class="flex-1 bg-gray-300 text-slate-300 py-2 border hover:bg-gray-400 transition-colors"
                            >
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentNetworkMode = 'TESTNET';
        let currentMerchant = null;
        let currentTab = 'orders';
        let merchantWallets = [];

        // Chain configuration
        const CHAINS = [
            { id: 'BASE_SEPOLIA', name: 'Base Sepolia', network: 'testnet', icon: 'üîµ' },
            { id: 'BASE_MAINNET', name: 'Base Mainnet', network: 'mainnet', icon: 'üîµ' },
            { id: 'ETHEREUM_SEPOLIA', name: 'Ethereum Sepolia', network: 'testnet', icon: '‚ü†' },
            { id: 'ETHEREUM_MAINNET', name: 'Ethereum Mainnet', network: 'mainnet', icon: '‚ü†' },
            { id: 'POLYGON_MAINNET', name: 'Polygon Mainnet', network: 'mainnet', icon: 'üü£' },
            { id: 'POLYGON_MUMBAI', name: 'Polygon Mumbai', network: 'testnet', icon: 'üü£' },
            { id: 'ARBITRUM_MAINNET', name: 'Arbitrum Mainnet', network: 'mainnet', icon: 'üî∑' },
            { id: 'ARBITRUM_SEPOLIA', name: 'Arbitrum Sepolia', network: 'testnet', icon: 'üî∑' },
            { id: 'SOLANA_MAINNET', name: 'Solana Mainnet', network: 'mainnet', icon: 'üåû' },
            { id: 'SOLANA_DEVNET', name: 'Solana Devnet', network: 'testnet', icon: 'üåû' }
        ];

        // Tab switching
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            
            // Show selected tab
            document.getElementById(tabName + 'Tab').classList.remove('hidden');
            
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('border-blue-500', 'text-blue-400');
                btn.classList.add('border-transparent', 'text-slate-400', 'hover:text-slate-300', 'hover:border-slate-800');
            });
            
            // Highlight active tab
            const activeBtn = document.querySelector(`[data-tab="${tabName}"]`);
            activeBtn.classList.remove('border-transparent', 'text-slate-400', 'hover:text-slate-300', 'hover:border-slate-800');
            activeBtn.classList.add('border-blue-500', 'text-blue-400');
            
            currentTab = tabName;
            
            // Load tab content
            if (tabName === 'orders') {
                loadOrders();
            } else if (tabName === 'wallets') {
                loadWallets();
            } else if (tabName === 'settings') {
                loadSettings();
            }
        }

        // Network switching
        function switchToTestnet() {
            currentNetworkMode = 'TESTNET';
            updateNetworkUI();
            refreshCurrentTab();
        }

        function switchToMainnet() {
            currentNetworkMode = 'MAINNET';
            updateNetworkUI();
            refreshCurrentTab();
        }

        function updateNetworkUI() {
            const banner = document.getElementById('networkBanner');
            const testnetBtn = document.getElementById('testnetBtn');
            const mainnetBtn = document.getElementById('mainnetBtn');

            if (currentNetworkMode === 'TESTNET') {
                banner.className = 'network-badge text-white text-center py-2 text-sm font-bold';
                banner.textContent = 'üß™ MERCHANT DASHBOARD - Testnet Mode';
                testnetBtn.className = 'network-btn px-3 py-1 rounded text-sm font-medium transition-colors bg-orange-100 text-orange-800';
                mainnetBtn.className = 'network-btn px-3 py-1 rounded text-sm font-medium transition-colors text-slate-400 hover:bg-slate-900/20';
            } else {
                banner.className = 'mainnet-badge text-white text-center py-2 text-sm font-bold';
                banner.textContent = 'üåê MERCHANT DASHBOARD - Mainnet Mode';
                mainnetBtn.className = 'network-btn px-3 py-1 rounded text-sm font-medium transition-colors bg-green-900/20 text-green-800';
                testnetBtn.className = 'network-btn px-3 py-1 rounded text-sm font-medium transition-colors text-slate-400 hover:bg-slate-900/20';
            }
        }

        function refreshCurrentTab() {
            if (currentTab === 'orders') {
                loadOrders();
            } else if (currentTab === 'wallets') {
                loadWallets();
            }
        }

        // Load merchant data
        async function loadMerchantData() {
            try {
                // Get merchant ID and token from session
                const merchantId = sessionStorage.getItem('merchantId');
                const merchantToken = sessionStorage.getItem('merchantToken');
                
                if (!merchantId && !merchantToken) {
                    console.error('No merchant authentication found');
                    window.location.href = '/login.html';
                    return;
                }

                // Fetch actual merchant data from API
                const response = await fetch(`/api/merchant-profile?${merchantId ? 'id=' + merchantId : 'token=' + merchantToken}`);
                
                if (!response.ok) {
                    throw new Error('Failed to load merchant data');
                }

                currentMerchant = await response.json();
                
                // Set defaults if missing
                currentMerchant.plan = currentMerchant.plan || 'STARTER';
                currentMerchant.networkMode = currentMerchant.networkMode || 'TESTNET';
                currentMerchant.paymentMode = currentMerchant.paymentMode || 'DIRECT';

                document.getElementById('merchantName').textContent = currentMerchant.companyName;

                // Update profile card
                document.getElementById('profileCompanyName').textContent = currentMerchant.companyName;
                document.getElementById('profileEmail').textContent = currentMerchant.email;
                document.getElementById('profileContact').textContent = currentMerchant.contactName;
                document.getElementById('profileNetworkMode').textContent = currentMerchant.networkMode === 'MAINNET' ? 'üåê Mainnet' : 'üß™ Testnet';
                document.getElementById('profilePlan').textContent = currentMerchant.plan || 'None';
                document.getElementById('profileOrderCount').textContent = currentMerchant.orderCount || 0;

                // Format created date
                if (currentMerchant.createdAt) {
                    const created = new Date(currentMerchant.createdAt);
                    document.getElementById('profileCreatedAt').textContent = created.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
                }

                // Update status badge
                const statusBadge = document.getElementById('profileStatusBadge');
                if (currentMerchant.isActive) {
                    statusBadge.className = 'inline-flex items-center px-4 py-2 rounded-full text-sm font-medium mb-2 bg-green-900/20 text-green-800';
                    statusBadge.innerHTML = '<span class="mr-2">‚úÖ</span><span>Active</span>';
                    document.getElementById('pendingBanner').classList.add('hidden');
                } else {
                    statusBadge.className = 'inline-flex items-center px-4 py-2 rounded-full text-sm font-medium mb-2 bg-yellow-900/20 text-yellow-800';
                    statusBadge.innerHTML = '<span class="mr-2">‚è≥</span><span>Pending Approval</span>';
                    document.getElementById('pendingBanner').classList.remove('hidden');
                }

                // Update settings form
                document.getElementById('companyName').value = currentMerchant.companyName;
                document.getElementById('contactName').value = currentMerchant.contactName;
                document.getElementById('email').value = currentMerchant.email;
                document.getElementById('plan').value = currentMerchant.plan;
                document.getElementById('defaultNetworkMode').value = currentMerchant.networkMode;
                document.getElementById('paymentMode').value = currentMerchant.paymentMode;

                currentNetworkMode = currentMerchant.networkMode;
                updateNetworkUI();

                // Update API developer section
                document.getElementById('apiMerchantId').textContent = currentMerchant.id;

                // Load current tab content after merchant data is ready
                if (currentTab === 'orders') {
                    loadOrders();
                } else if (currentTab === 'wallets') {
                    loadWallets();
                }
            } catch (error) {
                console.error('Error loading merchant data:', error);
            }
        }

        // Test Create Order API
        window.testCreateOrder = async function() {
            if (!currentMerchant) {
                alert('Please wait for merchant data to load');
                return;
            }

            if (merchantWallets.length === 0) {
                alert('‚ö†Ô∏è Please configure at least one wallet first');
                return;
            }

            // Use first configured chain
            const firstChain = merchantWallets[0].chain;

            try {
                const response = await fetch('/api/orders-simple', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        merchantId: currentMerchant.id,
                        amount: '10.00',
                        chain: firstChain,
                        customerEmail: 'test@example.com'
                    })
                });

                const result = await response.json();

                if (response.ok) {
                    alert(`‚úÖ Test order created successfully!\n\nOrder ID: ${result.id}\nChain: ${firstChain}\nAmount: 10.00 USDC`);
                } else {
                    alert(`‚ùå Test failed: ${result.error || 'Unknown error'}`);
                }
            } catch (error) {
                alert(`‚ùå Test failed: ${error.message}`);
            }
        };

        // Load orders
        async function loadOrders() {
            try {
                if (!currentMerchant?.id) {
                    renderOrdersTable([]);
                    updateStats({ orders: [], pagination: { total: 0 } });
                    return;
                }

                // Fetch orders for this merchant
                const response = await fetch(`/api/v1/admin?resource=orders&merchantId=${currentMerchant.id}`, {
                    headers: { 'Authorization': `Bearer ${merchantToken}` }
                });

                if (response.ok) {
                    const orders = await response.json();
                    updateStats({ orders, pagination: { total: orders.length } });
                    renderOrdersTable(orders);
                } else {
                    // No orders yet
                    renderOrdersTable([]);
                    updateStats({ orders: [], pagination: { total: 0 } });
                }
            } catch (error) {
                console.error('Error loading orders:', error);
                renderOrdersTable([]);
                updateStats({ orders: [], pagination: { total: 0 } });
            }
        }

        function updateStats(data) {
            const total = data.pagination ? data.pagination.total : data.orders.length;
            const confirmed = data.orders.filter(o => o.status === 'PAID' || o.status === 'CONFIRMED').length;
            const pending = data.orders.filter(o => o.status === 'PENDING').length;
            const totalVolume = data.orders.reduce((sum, o) => sum + (o.amount || 0), 0);

            document.getElementById('totalOrders').textContent = total;
            document.getElementById('confirmedOrders').textContent = confirmed;
            document.getElementById('pendingOrders').textContent = pending;
            document.getElementById('totalVolume').textContent = '$' + totalVolume.toFixed(2);
        }

        function renderOrdersTable(orders) {
            const tbody = document.getElementById('ordersTableBody');
            
            if (orders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="px-6 py-12 text-center text-slate-400">No orders found</td></tr>';
                return;
            }
            
            tbody.innerHTML = orders.map(order => {
                const statusClass = `status-${order.status.toLowerCase()}`;
                const shortId = order.id.slice(0, 8) + '...';
                const createdAt = new Date(order.createdAt).toLocaleDateString();
                
                return `
                    <tr class="hover:bg-slate-950">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-white">${shortId}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-semibold text-white">${order.amount} USDC</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-slate-400">${order.chain.replace('_', ' ')}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}">
                                ${order.status}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-slate-400">${order.customerEmail || 'Anonymous'}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-400">
                            ${createdAt}
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Load wallets
        async function loadWallets() {
            if (!currentMerchant) {
                console.log('loadWallets: currentMerchant not loaded yet');
                return;
            }

            console.log('loadWallets: Loading wallets for merchant', currentMerchant.id);

            try {
                // Fetch merchant wallets
                const merchantToken = sessionStorage.getItem('merchantToken');
                const response = await fetch(`/api/v1/admin?resource=wallets&merchantId=${currentMerchant.id}`, {
                    headers: { 'Authorization': `Bearer ${merchantToken}` }
                });

                if (response.ok) {
                    merchantWallets = await response.json();
                    console.log('loadWallets: Loaded', merchantWallets.length, 'wallets');
                } else {
                    console.log('loadWallets: API returned error', response.status);
                    merchantWallets = [];
                }

                renderChainToggles();
            } catch (error) {
                console.error('Error loading wallets:', error);
                merchantWallets = [];
                renderChainToggles();
            }
        }

        // Render chain toggles
        function renderChainToggles() {
            const container = document.getElementById('walletsContainer');
            console.log('renderChainToggles: Rendering', CHAINS.length, 'chains with', merchantWallets.length, 'existing wallets');

            container.innerHTML = CHAINS.map(chain => {
                const wallet = merchantWallets.find(w => w.chain === chain.id);
                const isEnabled = !!wallet;
                const address = wallet?.address || '';

                return `
                    <div class="bg-slate-950 border p-4 border border-slate-800 hover:border-slate-800 transition">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-3">
                                <span class="text-2xl">${chain.icon}</span>
                                <div>
                                    <div class="font-medium text-white">${chain.name}</div>
                                    <div class="text-xs text-slate-400">${chain.network}</div>
                                </div>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox"
                                       class="sr-only peer chain-toggle"
                                       data-chain="${chain.id}"
                                       ${isEnabled ? 'checked' : ''}
                                       onchange="toggleChainInput('${chain.id}')">
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-slate-950 after:border-slate-800 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                        <div id="wallet-input-${chain.id}" class="${isEnabled ? '' : 'hidden'} mt-2">
                            <input type="text"
                                   class="w-full px-3 py-2 text-sm border border-slate-800  font-mono"
                                   placeholder="0x... or wallet address"
                                   data-wallet-chain="${chain.id}"
                                   value="${address}">
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Toggle chain input visibility
        window.toggleChainInput = function(chainId) {
            const input = document.getElementById(`wallet-input-${chainId}`);
            const checkbox = document.querySelector(`input[data-chain="${chainId}"]`);

            if (checkbox.checked) {
                input.classList.remove('hidden');
            } else {
                input.classList.add('hidden');
                const walletInput = input.querySelector('input');
                if (walletInput) walletInput.value = '';
            }
        };

        // Save wallets
        document.getElementById('saveWalletsBtn').addEventListener('click', async () => {
            if (!currentMerchant) return;

            // Collect wallet configurations
            const wallets = [];
            document.querySelectorAll('.chain-toggle').forEach(toggle => {
                if (toggle.checked) {
                    const chain = toggle.dataset.chain;
                    const addressInput = document.querySelector(`input[data-wallet-chain="${chain}"]`);
                    const address = addressInput?.value.trim();

                    if (address) {
                        wallets.push({ chain, address });
                    }
                }
            });

            try {
                const merchantToken = sessionStorage.getItem('merchantToken');
                const response = await fetch(`/api/v1/admin?resource=wallets`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${merchantToken}`
                    },
                    body: JSON.stringify({
                        merchantId: currentMerchant.id,
                        wallets
                    })
                });

                if (response.ok) {
                    alert('‚úÖ Wallet configuration saved successfully!');
                    loadWallets(); // Reload
                } else {
                    const error = await response.json();
                    alert('Error: ' + (error.error || 'Failed to save wallets'));
                }
            } catch (error) {
                alert('Error saving wallets: ' + error.message);
            }
        });

        // Create Demo Store
        document.getElementById('createDemoStoreBtn').addEventListener('click', async () => {
            if (!currentMerchant) {
                alert('Please wait for merchant data to load');
                return;
            }

            if (merchantWallets.length === 0) {
                alert('‚ö†Ô∏è Please configure at least one wallet before creating a demo store');
                return;
            }

            // Generate a unique store URL for this merchant
            const storeUrl = `${window.location.origin}/store.html?merchant=${currentMerchant.id}`;

            // Show modal with store URL and preview
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-slate-950 border shadow-2xl p-8 max-w-2xl w-full mx-4">
                    <div class="text-center mb-6">
                        <div class="text-6xl mb-4">üéâ</div>
                        <h2 class="text-3xl font-bold text-white mb-2">Demo Store Created!</h2>
                        <p class="text-slate-400">Your custom payment store is ready with your configured wallets</p>
                    </div>

                    <div class="bg-gradient-to-r from-purple-50 to-blue-50 border p-6 mb-6 border border-purple-200">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-sm font-medium text-slate-300">Your Store URL:</span>
                            <button onclick="navigator.clipboard.writeText('${storeUrl}'); alert('‚úÖ Copied!')"
                                    class="text-blue-400 hover:text-blue-700 text-sm font-medium">
                                üìã Copy
                            </button>
                        </div>
                        <div class="bg-slate-950 border p-3 border border-slate-800">
                            <code class="text-sm text-purple-700 break-all">${storeUrl}</code>
                        </div>
                    </div>

                    <div class="bg-blue-50 border p-4 mb-6 border border-blue-200">
                        <h4 class="font-semibold text-blue-900 mb-2">üìù Store Features:</h4>
                        <ul class="text-sm text-blue-800 space-y-1">
                            <li>‚úÖ ${merchantWallets.length} blockchain${merchantWallets.length > 1 ? 's' : ''} enabled</li>
                            <li>‚úÖ Accepts USDC payments</li>
                            <li>‚úÖ Real-time order tracking</li>
                            <li>‚úÖ Automatic wallet selection</li>
                        </ul>
                    </div>

                    <div class="flex space-x-3">
                        <button onclick="window.open('${storeUrl}', '_blank')"
                                class="flex-1 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white px-6 py-3 border font-medium transition-all">
                            üöÄ Open Store
                        </button>
                        <button onclick="this.closest('.fixed').remove()"
                                class="px-6 py-3 border border-slate-800 border text-slate-300 hover:bg-slate-950 transition-colors">
                            Close
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // Close on background click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        });

        // Test Payment
        document.getElementById('testPaymentBtn').addEventListener('click', () => {
            if (merchantWallets.length === 0) {
                alert('‚ö†Ô∏è Please configure at least one wallet first');
                return;
            }

            // Open the store with a test mode parameter
            const storeUrl = `${window.location.origin}/store.html?merchant=${currentMerchant.id}&test=true`;
            window.open(storeUrl, '_blank');
        });

        // Load settings
        function loadSettings() {
            // Settings are already loaded in loadMerchantData
        }

        // Modal functions
        function showAddWalletModal() {
            const modal = document.getElementById('addWalletModal');
            const chainSelect = document.getElementById('walletChain');
            
            // Populate chain options based on current network mode
            const chains = currentNetworkMode === 'TESTNET' 
                ? [
                    { value: 'BASE_SEPOLIA', label: 'Base Sepolia (Testnet)' },
                    { value: 'ETHEREUM_SEPOLIA', label: 'Ethereum Sepolia (Testnet)' },
                    { value: 'POLYGON_MUMBAI', label: 'Polygon Mumbai (Testnet)' },
                    { value: 'ARBITRUM_SEPOLIA', label: 'Arbitrum Sepolia (Testnet)' },
                    { value: 'SOLANA_DEVNET', label: 'Solana Devnet (Testnet)' }
                ]
                : [
                    { value: 'BASE_MAINNET', label: 'Base Mainnet' },
                    { value: 'ETHEREUM_MAINNET', label: 'Ethereum Mainnet' },
                    { value: 'POLYGON_MAINNET', label: 'Polygon Mainnet' },
                    { value: 'ARBITRUM_MAINNET', label: 'Arbitrum Mainnet' },
                    { value: 'SOLANA_MAINNET', label: 'Solana Mainnet' }
                ];
            
            chainSelect.innerHTML = chains.map(chain => 
                `<option value="${chain.value}">${chain.label}</option>`
            ).join('');
            
            modal.classList.remove('hidden');
        }

        function hideAddWalletModal() {
            document.getElementById('addWalletModal').classList.add('hidden');
            document.getElementById('addWalletForm').reset();
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Tab switching
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => switchTab(btn.dataset.tab));
            });

            // Network switching
            document.getElementById('testnetBtn').addEventListener('click', switchToTestnet);
            document.getElementById('mainnetBtn').addEventListener('click', switchToMainnet);

            // Modal controls
            document.getElementById('addWalletBtn').addEventListener('click', showAddWalletModal);
            document.getElementById('closeWalletModal').addEventListener('click', hideAddWalletModal);
            document.getElementById('cancelWalletModal').addEventListener('click', hideAddWalletModal);

            // Refresh button
            document.getElementById('refreshOrdersBtn').addEventListener('click', loadOrders);

            // Logout
            document.getElementById('logoutBtn').addEventListener('click', () => {
                sessionStorage.removeItem('merchantToken');
                window.location.href = '/login.html';
            });

            // Add wallet form
            document.getElementById('addWalletForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const chain = document.getElementById('walletChain').value;
                const address = document.getElementById('walletAddress').value;
                
                // TODO: Validate address and add to database
                console.log('Adding wallet:', { chain, address });
                
                hideAddWalletModal();
                loadWallets();
                alert('Wallet added successfully!');
            });

            // Save profile button
            document.getElementById('saveProfileBtn').addEventListener('click', async () => {
                try {
                    const response = await fetch(`/api/merchant-profile`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            id: currentMerchant.id,
                            companyName: document.getElementById('companyName').value,
                            contactName: document.getElementById('contactName').value,
                            email: document.getElementById('email').value
                        })
                    });

                    if (response.ok) {
                        currentMerchant.companyName = document.getElementById('companyName').value;
                        currentMerchant.contactName = document.getElementById('contactName').value;
                        currentMerchant.email = document.getElementById('email').value;

                        // Update profile card
                        document.getElementById('merchantName').textContent = currentMerchant.companyName;
                        document.getElementById('profileCompanyName').textContent = currentMerchant.companyName;
                        document.getElementById('profileEmail').textContent = currentMerchant.email;
                        document.getElementById('profileContact').textContent = currentMerchant.contactName;

                        alert('‚úÖ Profile updated successfully!');
                    } else {
                        alert('‚ùå Failed to update profile');
                    }
                } catch (error) {
                    console.error('Error saving profile:', error);
                    alert('‚ùå Failed to save profile');
                }
            });

            // Save settings
            document.getElementById('saveSettingsBtn').addEventListener('click', async () => {
                try {
                    const response = await fetch(`/api/merchant-profile`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            id: currentMerchant.id,
                            plan: document.getElementById('plan').value,
                            networkMode: document.getElementById('defaultNetworkMode').value,
                            paymentMode: document.getElementById('paymentMode').value
                        })
                    });

                    if (response.ok) {
                        currentMerchant.plan = document.getElementById('plan').value;
                        currentMerchant.networkMode = document.getElementById('defaultNetworkMode').value;
                        currentMerchant.paymentMode = document.getElementById('paymentMode').value;

                        // Update profile card
                        document.getElementById('profilePlan').textContent = currentMerchant.plan || 'None';
                        document.getElementById('profileNetworkMode').textContent = currentMerchant.networkMode === 'MAINNET' ? 'üåê Mainnet' : 'üß™ Testnet';

                        currentNetworkMode = currentMerchant.networkMode;
                        updateNetworkUI();

                        alert('‚úÖ Settings saved successfully!');
                    } else {
                        alert('‚ùå Failed to save settings');
                    }
                } catch (error) {
                    console.error('Error saving settings:', error);
                    alert('‚ùå Failed to save settings');
                }
            });

            // Initialize
            // Check for pending status
            const isPending = sessionStorage.getItem("isPending") === "true";
            if (isPending) {
                document.getElementById("pendingBanner").classList.remove("hidden");
            }

            // Load merchant data first, it will trigger loading the current tab
            loadMerchantData();
        });
    </script>
</body>
</html>